<!DOCTYPE html>
<html lang="pt-BR" class="no-js">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="description" content="Clean Helmet - Sistema de Desinfec√ß√£o Profissional com ESP32">
  <meta name="keywords" content="capacete, desinfec√ß√£o, ESP32, Raspberry Pi, Firebase, UV, oz√¥nio">
  <meta name="author" content="Clean Helmet Systems">
  <meta name="theme-color" content="#1e3a8a">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Clean Helmet">
  
  <title>Clean Helmet - Desinfec√ß√£o Profissional</title>
  
  <!-- Preload critical resources -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" as="style">
  
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Styles -->
  <link rel="stylesheet" href="styles-touch-sequential-complete.css">
  
  <!-- Firebase SDK v9.22.0 (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
  
  <!-- PWA Manifest (desabilitado para desenvolvimento local) -->
  <!-- <link rel="manifest" href="manifest.json"> -->
  
  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üèçÔ∏è</text></svg>">
  
  <!-- Remove no-js class when JavaScript loads -->
  <script>document.documentElement.classList.remove('no-js');</script>
</head>

<body class="theme-dark">
  <!-- Loading Overlay -->
  <div id="loadingOverlay" class="loading-overlay">
    <div class="loading-spinner"></div>
    <div class="loading-text">
      ü§ñ Inicializando Clean Helmet...<br>
      <small>Sistema de Desinfec√ß√£o Profissional</small>
    </div>
  </div>

  <!-- App Container -->
  <body>
<div id="clockDisplay" class="clock-display">
  <span id="clockTime">--:--</span>
  <span id="clockDate">--/--/----</span>
</div>

  <div class="main-layout">

    <!-- Moldura de an√∫ncios tipo smartphone -->
    <div class="ads-phone-frame">
      <div class="ads-phone-screen">
        <div class="ads-container" id="adsContainer">
          <!-- Slides de an√∫ncios inseridos dinamicamente -->
        </div>
        <div class="ads-dots" id="adsDots"></div>
      </div>
    </div>

    <!-- √Årea principal do sistema -->
    <div class="cycle-section">
      <div class="app-container">

        <!-- Header -->
        <header class="header">
          <div class="logo-section">
            <div class="helmet-icon"><img src="assets/logo.png" alt="Logo Clean Helmet" style="width: 65px; height: auto;" />
            </div>
            <div class="brand-info">
              <h1>Clean Helmet</h1>
              <p>Sistema Inteligente de Desinfec√ß√£o</p>
            </div>
          </div>    
        </header>

        <!-- Status Display -->
        <div class="status-display">
          <div class="connection-status">
            <div id="connectionStatus" class="status-indicator online"></div>
            <span class="status-text">Sistema Online</span>
          </div>
          <div class="cycle-status-display">
            <span id="cycleStatus" class="cycle-status">Aguardando</span>
          </div>
        </div>

        <!-- Start Section -->
        <div id="startSection" class="start-section">
          <div class="start-content">
            <div class="start-icon">
              <div class="helmet-animation"><img src="assets/logo.png" alt="Logo Clean Helmet"
 style="width: 100px; height: auto;" />
</div>
            </div>
            <h2>Desinfec√ß√£o Profissional</h2>
            <p>Sistema inteligente de Desinfec√ß√£o</p>
            <div class="payment-info">
              <strong>Ciclos adicionais:</strong> R$ 20,00 (PIX ou Cart√£o)
            </div>
            <button id="startBtn" class="start-btn">
              <span class="btn-icon">üöÄ</span>
              <span>Iniciar Desinfec√ß√£o</span>
            </button>
          </div>
        </div>

        <!-- Cycle Steps -->
        <div id="cycleSteps" class="cycle-steps hidden">
          <h3>üîÑ Etapas do Processo</h3>
          <div class="steps-container">
            <!-- Step 1 -->
            <div class="step-item" data-step="0">
              <div class="step-icon">üí®</div>
              <div class="step-info">
                <h4>Oxi-Sanitiza√ß√£o</h4>
                <p>Elimina√ß√£o de germes e bact√©rias com oz√¥nio controlado</p>
              </div>
              <div class="step-progress">
                <svg class="progress-ring" width="60" height="60">
                  <circle class="progress-ring-circle" cx="30" cy="30" r="25"></circle>
                </svg>
                <div class="progress-text">120s</div>
              </div>
            </div>

            <!-- Step 2 -->
            <div class="step-item" data-step="1">
              <div class="step-icon">‚ùÑÔ∏è</div>
              <div class="step-info">
                <h4>Neutraliza√ß√£o</h4>
                <p>Dispers√£o segura do oz√¥nio com ventila√ß√£o</p>
              </div>
              <div class="step-progress">
                <svg class="progress-ring" width="60" height="60">
                  <circle class="progress-ring-circle" cx="30" cy="30" r="25"></circle>
                </svg>
                <div class="progress-text">30s</div>
              </div>
            </div>

            <!-- Step 3 -->
            <div class="step-item" data-step="2">
              <div class="step-icon">üîÜ</div>
              <div class="step-info">
                <h4>UV Germicida</h4>
                <p>Desinfec√ß√£o por luz ultravioleta de alta intensidade</p>
              </div>
              <div class="step-progress">
                <svg class="progress-ring" width="60" height="60">
                  <circle class="progress-ring-circle" cx="30" cy="30" r="25"></circle>
                </svg>
                <div class="progress-text">90s</div>
              </div>
            </div>

            <!-- Step 4 -->
            <div class="step-item" data-step="3">
              <div class="step-icon">üåø</div>
              <div class="step-info">
                <h4>Desodoriza√ß√£o</h4>
                <p>Aplica√ß√£o de fragr√¢ncia fresh e finaliza√ß√£o</p>
              </div>
              <div class="step-progress">
                <svg class="progress-ring" width="60" height="60">
                  <circle class="progress-ring-circle" cx="30" cy="30" r="25"></circle>
                </svg>
                <div class="progress-text">60s</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Safety Info -->
        <div id="safetyInfo" class="safety-info hidden">
          <div class="safety-card">
            <div class="safety-icon">‚ö†Ô∏è</div>
            <div class="safety-content">
              <h4>Informa√ß√µes de Seguran√ßa</h4>
              <ul>
                <li>üö™ Sensor de porta monitora abertura em tempo real</li>
                <li>üå°Ô∏è Controle autom√°tico de temperatura pelos sensores</li>
              </ul>
            </div>
          </div>
        </div>

        <!-- Completion Section -->
        <div id="completionSection" class="completion-section hidden">
          <div class="completion-content">
            <div class="completion-icon"><img src="assets/check.png" alt="Logo Clean Helmet" style="width: 100px; height: auto;" /></div>
            <h2>Desinfec√ß√£o Conclu√≠da!</h2>
            <p>Seu capacete foi desinfetado com sucesso</p>
            <div class="completion-stats">
              <div class="stat-item">
                <span class="stat-value">99,9%</span>
                <span class="stat-label">Germes eliminados</span>
              </div>
              <div class="stat-item">
                <span class="stat-value">5 min</span>
                <span class="stat-label">Tempo Total</span>
              </div>
            </div>
            <button id="newCycleBtn" class="new-cycle-btn">
              <span class="btn-icon">üîÑ</span>
              <span>Novo Ciclo</span>
            </button>
          </div>
        </div>

      </div> <!-- app-container -->
    </div> <!-- cycle-section -->

  </div> <!-- main-layout -->
</body>

    </main>

    <!-- Footer -->
    <footer class="footer">
      <div class="footer-content">
        <div class="footer-info">
          <span>Clean Helmet v4.0.0</span>
          <span>‚Ä¢</span>
          <span>Desinfection</span>
          <span>‚Ä¢</span>
          <span>Integration</span>
        </div>
        
        <div class="footer-controls">
          <button class="footer-btn" title="Informa√ß√µes" onclick="alert('Clean Helmet v4.0.0\\nSistema ESP32 + Raspberry Pi + Firebase\\nDesenvolvido para tela touch 1280x800\\n\\nRecursos:\\n‚Ä¢ Controle sequencial rigoroso\\n‚Ä¢ Sensores em tempo real\\n‚Ä¢ Sistema de pagamentos integrado\\n‚Ä¢ 8 temas din√¢micos\\n‚Ä¢ Otimiza√ß√£o touch completa')">‚ÑπÔ∏è</button>
          <button class="footer-btn" title="Configura√ß√µes" onclick="window.helmetMistApp?.openSettings()">‚öôÔ∏è</button>
          <button class="footer-btn" title="Debug Console" onclick="console.log('=== CLEAN HELMET DEBUG INFO ==='); console.table(window.DEBUG?.info()); console.log('Use DEBUG.help() para comandos dispon√≠veis');">üîß</button>
        </div>
      </div>
    </footer>
  </div>

  <!-- Settings Modal -->
  <div id="settingsModal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <h3>‚öôÔ∏è Configura√ß√µes</h3>
        <button id="closeSettings" class="modal-close">‚úï</button>
      </div>
      
      <div class="modal-body">
        <div class="setting-group">
          <label for="themeSelect">üé® Tema Visual:</label>
          <select id="themeSelect">
            <option value="dark">üåô Dark Cyber</option>  
          </select>
        </div>
        
        <div class="setting-group">
          <label for="volumeSlider">üîä Volume do Sistema:</label>
          <input type="range" id="volumeSlider" min="0" max="100" value="75">
        </div>
        
        <div class="setting-group">
          <label>Sistema:</label>
          <div style="background: var(--bg-tertiary); padding: var(--spacing-md); border-radius: var(--border-radius-md); font-family: monospace; font-size: var(--font-size-sm);">
            <div>‚Ä¢ Sensores: Porta, Temperatura, Umidade, Oz√¥nio, UV</div>
            <div>‚Ä¢ Rel√©s: 7 canais (Oz√¥nio, UV, Ventiladores, Bomba)</div>
            <div>‚Ä¢ Comunica√ß√£o: Serial ‚Üí Raspberry Pi ‚Üí Firebase</div>
            <div>‚Ä¢ Monitoramento: Tempo real via WebSocket</div>
          </div>
        </div>
        
        <div class="setting-group">
          <label>üì± Informa√ß√µes da Tela:</label>
          <div style="background: var(--bg-tertiary); padding: var(--spacing-md); border-radius: var(--border-radius-md); font-family: monospace; font-size: var(--font-size-sm);">
            <div>‚Ä¢ Resolu√ß√£o: <span id="screenResolution">Carregando...</span></div>
            <div>‚Ä¢ Tipo: <span id="screenType">Carregando...</span></div>
            <div>‚Ä¢ Touch: <span id="touchSupport">Carregando...</span></div>
            <div>‚Ä¢ Orienta√ß√£o: <span id="screenOrientation">Carregando...</span></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Notifications Container -->
  <div id="notifications" class="notifications-container"></div>

  <!-- üÜï NOVOS M√ìDULOS CLEAN HELMET v4.0.0 -->
<script src="js/offline-manager.js"></script>
<script src="js/session-manager.js"></script>
<script src="js/mercadopago-manager.js"></script>
  
  <!-- JavaScript -->
  <script src="clean-helmet-client-final.js"></script>
  
  <!-- Screen Info Script -->
  <script>
    // Atualiza informa√ß√µes da tela no modal de configura√ß√µes
    function updateScreenInfo() {
      const screenRes = document.getElementById('screenResolution');
      const screenType = document.getElementById('screenType');
      const touchSupport = document.getElementById('touchSupport');
      const screenOrientation = document.getElementById('screenOrientation');
      
      if (screenRes) screenRes.textContent = `${screen.width}x${screen.height}`;
      if (screenType) screenType.textContent = window.innerWidth <= 1280 && window.innerHeight <= 800 ? 'Touch Otimizada' : 'Desktop';
      if (touchSupport) touchSupport.textContent = 'ontouchstart' in window ? 'Suportado' : 'N√£o detectado';
      if (screenOrientation) screenOrientation.textContent = window.innerWidth > window.innerHeight ? 'Paisagem' : 'Retrato';
    }
    
    // Atualiza informa√ß√µes quando o modal √© aberto
    document.addEventListener('DOMContentLoaded', () => {
      updateScreenInfo();
      window.addEventListener('resize', updateScreenInfo);
      window.addEventListener('orientationchange', () => {
        setTimeout(updateScreenInfo, 100);
      });
    });
  </script>

  <!-- Service Worker Registration -->
  <script>
    // Registra Service Worker para PWA (se dispon√≠vel)
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then(registration => console.log('SW registered:', registration))
          .catch(error => console.log('SW registration failed:', error));
      });
    }
  </script>

  <!-- Performance Monitoring -->
  <script>
    // Monitora performance da aplica√ß√£o
    window.addEventListener('load', () => {
      const loadTime = performance.now();
      console.log(`üöÄ Clean Helmet carregado em ${Math.round(loadTime)}ms`);
      
      // Log para Firebase se dispon√≠vel
      setTimeout(() => {
        if (window.helmetMistApp?.components?.firebaseManager) {
          window.helmetMistApp.components.firebaseManager.log('app_loaded', {
            loadTime: Math.round(loadTime),
            userAgent: navigator.userAgent,
            screenSize: `${screen.width}x${screen.height}`,
            timestamp: Date.now()
          });
        }
      }, 2000);
    });
  </script>

  <!-- Error Handling -->
  <script>
    // Captura erros globais e remove loading se necess√°rio
    window.addEventListener('error', (event) => {
      console.error('Erro global capturado:', event.error);
      
      // Remove loading overlay se ainda estiver presente
      const loadingOverlay = document.getElementById('loadingOverlay');
      if (loadingOverlay) {
        loadingOverlay.style.display = 'none';
      }
    });

    window.addEventListener('unhandledrejection', (event) => {
      console.error('Promise rejeitada:', event.reason);
      
      // Remove loading overlay se ainda estiver presente
      const loadingOverlay = document.getElementById('loadingOverlay');
      if (loadingOverlay) {
        loadingOverlay.style.display = 'none';
      }
    });
  </script>

  <!-- Touch Optimization -->
  <script>
    // Otimiza√ß√µes espec√≠ficas para touch
    document.addEventListener('DOMContentLoaded', () => {
      // Previne zoom duplo toque
      let lastTouchEnd = 0;
      document.addEventListener('touchend', (event) => {
        const now = (new Date()).getTime();
        if (now - lastTouchEnd <= 300) {
          event.preventDefault();
        }
        lastTouchEnd = now;
      }, false);

      // Adiciona classe touch se suportado
      if ('ontouchstart' in window) {
        document.body.classList.add('touch-device');
      }

      // Otimiza√ß√£o para tela 1280x800
      if (window.innerWidth <= 1280 && window.innerHeight <= 800) {
        document.body.classList.add('optimized-1280x800');
      }
    });
  </script>

  <!-- Manifest JSON inline (fallback) -->
  <script type="application/json" id="manifest-fallback">
    {
      "name": "Clean Helmet - Sistema ESP32",
      "short_name": "Clean Helmet",
      "description": "Sistema de Desinfec√ß√£o Profissional com ESP32 e Raspberry Pi",
      "start_url": "/",
      "display": "standalone",
      "background_color": "#0f172a",
      "theme_color": "#1e3a8a",
      "orientation": "landscape",
      "icons": [
        {
          "src": "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'><text y='0.9em' font-size='90'>üèçÔ∏è</text></svg>",
          "sizes": "512x512",
          "type": "image/svg+xml"
        }
      ]
    }
  </script>
<script>
  function updateClock() {
    const now = new Date();
    const time = now.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
    const date = now.toLocaleDateString('pt-BR', { weekday: 'short', day: '2-digit', month: '2-digit', year: 'numeric' });

    document.getElementById('clockTime').textContent = time;
    document.getElementById('clockDate').textContent = date;
  }

  setInterval(updateClock, 1000);
  updateClock(); // inicializa imediatamente
</script>
</body>
</html>

</body>
</html>